<div class="admin-wrap">
  <header class="page-head">
    <h2 class="text-blush">Upload Music Content</h2>
    <p>Upload audio files and define metadata.</p>
  </header>

  <section class="card grid">
    <!-- LEFT: unchanged -->
    <div class="col">
      <h3 class="text-cyclamen">File(s)</h3>

      <div class="dropzone fancy" (drop)="onDrop($event)" (dragover)="onDragOver($event)">
        <input type="file" #fileInput multiple accept="audio/*" (change)="onFilesSelected($event)">
        <div class="dz-inner">
          <div class="dz-icon">ðŸŽµ</div>
          <p>Drag & drop audio file(s) here or</p>
          <button type="button" class="btn btn-primary btn-pill" (click)="fileInput.click()">Choose files</button>
          <small>Supported: mp3, wav, flac</small>
        </div>
      </div>

      <div class="image-upload">
        <label class="label">Cover image (optional)</label>
        <div class="image-row">
          <input type="file" accept="image/*" (change)="onCoverSelected($event)">
          <img *ngIf="coverPreview" [src]="coverPreview" alt="Cover preview">
        </div>
      </div>

      <div *ngIf="files.length" class="file-list">
        <h4>Selected files</h4>
        <table>
          <thead>
            <tr>
              <th>Name</th><th>Type</th><th>Size</th><th>Created</th><th>Last modified</th><th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let f of files; let i = index">
              <td>{{ f.name }}</td>
              <td>{{ f.type || 'unknown' }}</td>
              <td>{{ f.size | number }} B</td>
              <td>{{ getCreatedAt(f) }}</td>
              <td>{{ getUpdatedAt(f) }}</td>
              <td><button class="link" type="button" (click)="remove(i)">Remove</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- RIGHT: tabs + dynamic forms -->
    <div class="col">
      <h3 class="text-cyclamen">Metadata</h3>

      <mat-tab-group [(selectedIndex)]="tabIndex" class="tabs">
        <!-- SINGLE TAB -->
        <mat-tab label="Add Single">
          <form [formGroup]="singleForm" (ngSubmit)="submitSingle()" class="nice-form">
            <div class="row">
              <mat-form-field appearance="outline" class="full fancy-ff">
                <mat-label>Single title</mat-label>
                <input matInput formControlName="title" required>
              </mat-form-field>
            </div>

            <div class="row">
              <mat-form-field appearance="outline" class="full fancy-ff">
                <mat-label>Genres</mat-label>
                <mat-select formControlName="genres" multiple>
                  <mat-option *ngFor="let g of genreOptions" [value]="g">{{ g }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="row">
              <mat-form-field appearance="outline" class="full fancy-ff">
                <mat-label>Artists</mat-label>
                <input matInput placeholder="IDs or names, comma-separated" formControlName="artistIds">
              </mat-form-field>
            </div>

            <div class="row two">
              <mat-form-field appearance="outline" class="fancy-ff">
                <mat-label>Track number</mat-label>
                <input matInput type="number" formControlName="trackNo">
              </mat-form-field>

              <mat-form-field appearance="outline" class="fancy-ff">
                <mat-label>Release date (optional)</mat-label>
                <input matInput type="date" formControlName="releaseDate">
              </mat-form-field>
            </div>

            <div class="row toggle-row">
              <mat-slide-toggle formControlName="explicit">Explicit content</mat-slide-toggle>
            </div>

            <div class="row actions">
              <button mat-raised-button class="btn btn-primary btn-lg btn-pill" type="submit"
                      [disabled]="!files.length || singleForm.invalid">
                Save metadata & upload
              </button>
              <button mat-stroked-button type="button" class="btn btn-secondary btn-lg btn-pill" (click)="resetSingle()">
                Reset
              </button>
            </div>
          </form>
        </mat-tab>

        <!-- ALBUM TAB -->
        <mat-tab label="Add Album">
          <form [formGroup]="albumForm" (ngSubmit)="submitAlbum()" class="nice-form">
            <div class="row">
              <mat-form-field appearance="outline" class="full fancy-ff">
                <mat-label>Album title</mat-label>
                <input matInput formControlName="title" required>
              </mat-form-field>
            </div>

            <div class="row">
              <mat-form-field appearance="outline" class="full fancy-ff">
                <mat-label>Genres</mat-label>
                <mat-select formControlName="genres" multiple>
                  <mat-option *ngFor="let g of genreOptions" [value]="g">{{ g }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="row">
              <mat-form-field appearance="outline" class="full fancy-ff">
                <mat-label>Artists</mat-label>
                <input matInput placeholder="IDs or names, comma-separated" formControlName="artistIds">
              </mat-form-field>
            </div>

            <div class="row two">
              <mat-form-field appearance="outline" class="fancy-ff">
                <mat-label>Album ID (optional)</mat-label>
                <input matInput formControlName="albumId">
              </mat-form-field>

              <mat-form-field appearance="outline" class="fancy-ff">
                <mat-label>Release year</mat-label>
                <input matInput type="number" formControlName="releaseYear">
              </mat-form-field>
            </div>

            <div class="row actions">
              <button mat-raised-button class="btn btn-primary btn-lg btn-pill" type="submit"
                      [disabled]="!files.length || albumForm.invalid">
                Save album metadata & upload
              </button>
              <button mat-stroked-button type="button" class="btn btn-secondary btn-lg btn-pill" (click)="resetAlbum()">
                Reset
              </button>
            </div>

            <p class="hint">All selected files will be attached to this album.</p>
          </form>
        </mat-tab>
      </mat-tab-group>
    </div>
  </section>
</div>
